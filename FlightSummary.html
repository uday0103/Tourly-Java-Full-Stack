<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Flight Booking Summary - Tourly</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;600;700;800&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
    <link rel="shortcut icon" href="./favicon.svg" type="image/svg+xml">
    <style>
        /* Custom Properties (Consistent with previous files) */
        :root {
            --primary-dark: #2A3B4C; /* Dark blue */
            --secondary-light: #F8F8F8; /* White/off-white */
            --accent-blue: #007bff; /* A standard blue for buttons/accents */
            --text-dark: #333;
            --text-medium: #555;
            --text-light: #888;
            --border-light: #ddd;

            --ff-poppins: "Poppins", sans-serif;
            --ff-montserrat: "Montserrat", sans-serif;

            --fs-h1: 3em;
            --fs-h2: 2.2em;
            --fs-h3: 1.6em;
            --fs-body: 1em;
            --fs-small: 0.9em;

            --fw-normal: 400;
            --fw-medium: 500;
            --fw-semibold: 600;
            --fw-bold: 700;
            --fw-extrabold: 800;

            --spacing-medium: 20px;
            --spacing-large: 40px;
            --border-radius: 8px;
            --box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            --transition-speed: 0.3s ease;

            /* Specific colors for this theme from Tourly theme adjustments */
            --united-nations-blue: hsl(214, 56%, 58%);
            --bright-navy-blue: hsl(214, 57%, 51%); /* Main button/accent color */
            --spanish-gray: hsl(0, 0%, 60%);
            --black-coral: hsl(225, 8%, 42%);
            --oxford-blue: hsl(208, 97%, 12%);
            --yale-blue: hsl(214, 72%, 33%); /* Darker blue for hover */
            --blue-ncs: hsl(197, 100%, 36%); /* Another shade of blue if needed */
            --gunmetal: hsl(206, 34%, 20%);
            --gainsboro: hsl(0, 0%, 88%);
            --cultured: hsl(0, 0%, 98%);
            --white: hsl(0, 0%, 100%);
            --black: hsl(0, 0%, 0%);
            --onyx: hsl(0, 0%, 25%);
            --jet: hsl(0, 0%, 20%);

            --fs-1: calc(20px + 3.5vw);
            --fs-2: calc(18px + 1.6vw);
            --fs-3: calc(16px + 0.45vw);
            --fs-4: 15px;
            --fs-5: 14px;
            --fs-6: 13px;
            --fs-7: 12px;
            --fs-8: 11px;

            --fw-500: 500;
            --fw-600: 600;
            --fw-700: 700;
            --fw-800: 800;

            --transition: 0.25s ease-in-out;
            --section-padding: 60px;
            --radius-15: 15px;
            --radius-25: 25px; 
        }

        /* Body and main layout */
        body {
            font-family: var(--ff-poppins);
            background: linear-gradient(to bottom right, #e0f7fa, #ffffff); /* Light blue to white gradient */
            color: var(--text-dark);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        /* Summary Box Container */
        .summary-box {
            background-color: var(--white);
            border-radius: var(--radius-15);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); /* Lighter shadow for consistency */
            padding: 40px;
            width: 100%;
            max-width: 600px; /* Adjusted max-width */
            text-align: center;
            animation: fadeIn 1s ease-out;
        }

        h2 {
            font-family: var(--ff-montserrat);
            font-size: var(--fs-h2);
            color: var(--oxford-blue); /* Dark blue heading color */
            margin-bottom: 30px;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); /* Lighter text shadow */
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        #summaryContent {
            background-color: var(--cultured); /* Light grey for summary background */
            border-radius: var(--radius-15);
            padding: 30px;
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.05); /* Subtle inner shadow */
            border: 1px solid var(--gainsboro); /* Light border */
            width: 100%;
            margin-bottom: 30px;
        }

        #summaryContent p {
            font-size: var(--fs-body);
            margin-bottom: 15px;
            line-height: 1.6;
            color: var(--black-coral); /* Consistent text color */
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 8px;
            border-bottom: 1px dashed var(--border-light); /* Consistent dashed border */
        }

        #summaryContent p:last-child {
            margin-bottom: 0;
            border-bottom: none;
            font-size: var(--fs-h3); /* Slightly larger for total */
            font-weight: var(--fw-bold);
            color: var(--bright-navy-blue); /* Accent color for total price */
            padding-top: 10px;
        }

        #summaryContent p strong {
            color: var(--oxford-blue); /* Darker color for labels */
            min-width: 120px;
            display: inline-block;
        }

        button {
            background-color: var(--bright-navy-blue); /* Consistent button color */
            color: var(--white);
            border: none;
            border-radius: 50px; /* More rounded buttons */
            padding: 14px 30px; /* Larger padding */
            font-size: var(--fs-body);
            font-weight: var(--fw-semibold);
            cursor: pointer;
            margin: 0 10px; /* Adjusted margin */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15); /* Consistent shadow */
            transition: all var(--transition-speed);
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            background-color: var(--yale-blue); /* Darker on hover */
        }

        button:active {
            transform: translateY(0);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Payment Popup Styles (Identical to hotels.html) */
        .payment-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6); /* Semi-transparent black overlay */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000; /* High z-index to appear on top of everything */
            opacity: 0; /* Start hidden */
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .payment-popup.show {
            opacity: 1;
            visibility: visible;
        }

        .payment-popup-content {
            background-color: var(--white);
            padding: 40px;
            border-radius: var(--radius-15);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            text-align: center;
            max-width: 400px;
            transform: translateY(-20px); /* Initial position for animation */
            transition: transform 0.3s ease;
        }

        .payment-popup.show .payment-popup-content {
            transform: translateY(0); /* Animate to final position */
        }

        .payment-popup-content ion-icon {
            font-size: 80px;
            color: #28a745; /* Green for success */
            margin-bottom: 20px;
            --ionicon-stroke-width: 25px; /* Adjust stroke thickness for the icon */
        }

        .payment-popup-content h3 {
            font-family: var(--ff-montserrat);
            font-size: var(--fs-h2);
            font-weight: var(--fw-bold);
            color: var(--oxford-blue);
            margin-bottom: 10px;
        }

        .payment-popup-content p {
            font-size: var(--fs-body);
            color: var(--black-coral);
            margin-bottom: 25px;
        }

        .payment-popup-content button {
            padding: 12px 30px;
            background-color: var(--bright-navy-blue);
            color: var(--white);
            border-radius: 50px;
            font-weight: var(--fw-semibold);
            transition: background-color 0.3s ease;
        }

        .payment-popup-content button:hover {
            background-color: var(--yale-blue);
        }

        @media (max-width: 600px) {
            h2 {
                font-size: 2em;
                margin-bottom: 20px;
            }

            .summary-box {
                padding: 25px;
            }

            #summaryContent {
                padding: 20px;
                margin-bottom: 25px;
            }

            #summaryContent p {
                font-size: 1.1em;
                flex-direction: column;
                align-items: flex-start;
            }

            #summaryContent p strong {
                margin-bottom: 5px;
                min-width: unset; /* Remove min-width on small screens */
            }

            #summaryContent p:last-child {
                font-size: 1.2em;
            }

            button {
                padding: 10px 20px;
                font-size: 1em;
                margin: 0 8px;
            }
            .payment-popup-content {
                padding: 30px;
            }
            .payment-popup-content ion-icon {
                font-size: 60px;
            }
            .payment-popup-content h3 {
                font-size: var(--fs-3);
            }
            .payment-popup-content p {
                font-size: var(--fs-5);
            }
            .payment-popup-content button {
                padding: 10px 25px;
                font-size: var(--fs-5);
            }
        }
    </style>
</head>
<body>

    <div class="summary-box">
        <h2>Booking Summary</h2>
        <div class="summary-details" id="summaryContent"></div>
        
        <button class="pay-btn1" onclick="goBackToFlights()">Back to Flights</button>
        <button class="pay-btn" >Pay Now</button>
    </div>

    <div id="paymentPopup" class="payment-popup">
        <div class="payment-popup-content">
            <ion-icon name="checkmark-circle-outline"></ion-icon>
            <h3>Payment Successful!</h3>
            <p>Your flight booking has been confirmed.</p>
            <button id="closePopupBtn">OK</button>
        </div>
    </div>

    <script>
        // Navigate to flight booking page
        function goBackToFlights() {
            window.location.href = 'flightindex.html';
        }

        // Get all necessary data
        const user = JSON.parse(localStorage.getItem('user'));
        const userName = sessionStorage.getItem('userName');
        const numTravellers = parseInt(sessionStorage.getItem('numTravellers'));
        const selectedFlight = JSON.parse(sessionStorage.getItem('finalFlightDetails'));

        if (user && userName && numTravellers && selectedFlight && selectedFlight.date) {
    const pricePerPerson = parseInt(selectedFlight.price.replace(/[^\d]/g, ''));
    const totalPrice = pricePerPerson * numTravellers;

    document.getElementById('summaryContent').innerHTML = `
        <p><strong>Name:</strong> ${userName}</p>
        <p><strong>Travellers:</strong> ${numTravellers}</p>
        <p><strong>Flight:</strong> ${selectedFlight.airline}</p>
        <p><strong>From:</strong> ${selectedFlight.from}</p>
        <p><strong>To:</strong> ${selectedFlight.to}</p>
        <p><strong>Date:</strong> ${selectedFlight.date}</p>
        <p><strong>Price Per Person:</strong> ₹${pricePerPerson}</p>
        <p><strong>Total Price:</strong> ₹${totalPrice}</p>
    `;
} else {
    document.getElementById('summaryContent').innerHTML = `<p>No booking data found. Please go back and select a flight.</p>`;
}


        // Get popup elements
        const paymentPopup = document.getElementById("paymentPopup");
        const closePopupBtn = document.getElementById("closePopupBtn");

        function showPaymentPopup() {
            paymentPopup.classList.add("show");
        }

        function hidePaymentPopup() {
            paymentPopup.classList.remove("show");
            // After successful payment and closing the popup, redirect to the user dashboard
            window.location.href = "index.html"; // Changed redirect from User.html to dashboard.html for consistency
        }

        // Add event listener to close button
        closePopupBtn.addEventListener("click", hidePaymentPopup);

        // Attach event listener to "Pay Now" button
        document.querySelector(".pay-btn").addEventListener("click", function bookFlight() {
            if (!user || !userName || !selectedFlight || !numTravellers || !selectedFlight.date) {
                alert("Booking details missing. Please try again.");
                return;
            }

            const pricePerPerson = parseInt(selectedFlight.price.replace(/[^\d]/g, ''));
            const totalPrice = pricePerPerson * numTravellers;

            const bookingData = {
                userId: user.id,
                name: userName,
                airline: selectedFlight.airline,
                fromLocation: selectedFlight.from,
                toLocation: selectedFlight.to,
                date : selectedFlight.date,
                travellers: numTravellers,
                totalPrice: totalPrice
            };

            fetch("http://localhost:8080/api/flights/book", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(bookingData)
            })
            .then(response => {
                if (!response.ok) throw new Error("Flight booking failed.");
                return response.json();
            })
            .then(data => {
                showPaymentPopup(); // Show the pop-up on successful payment
                // The redirect to dashboard.html will happen when the user clicks 'OK' on the popup
                setTimeout(() => {
                    paymentPopup.classList.remove("show");
                    window.location.href = "index.html";
                }, 3000); // 3000ms = 3 seconds
            })
            .catch(error => {
                console.error("Booking error:", error);
                alert("Error occurred during booking. Please try again.");
            });
        });
    </script>
</body>
</html>